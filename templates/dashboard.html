<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">

    <!-- PWA Meta Tags -->
    <meta name="application-name" content="Inspec">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Inspec">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2196F3">

    <!-- iOS Safari specific meta tags for fullscreen -->
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-touch-fullscreen" content="yes">

    <!-- Icons for PWA -->
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/static/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/static/icon-512.png">

    <!-- Apple Touch Icon (for iOS home screen) -->
    <link rel="apple-touch-icon" href="/static/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/static/manifest.json">

    <title>Inspector Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: url('{{ url_for("static", filename="d.jpg") }}') no-repeat center center fixed;
            background-size: cover;
        }
        .container {
            width: 90%;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* Header buttons container */
        .header-buttons {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 20px;
            z-index: 100;
        }

        /* Header logo container */
        .header-logo {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }

        .header-logo img {
            height: 110px;
            width: auto;
            object-fit: contain;
            border-radius: 8px;
        }




        /* Theme toggle button specific styles */



        /* My Inspections Button */
.my-inspections-button {
    background: linear-gradient(135deg, #4facfe, #00f2fe);
    position: relative;
    padding: 12px 24px;
    color: white;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.my-inspections-button:hover {
    background: linear-gradient(135deg, #00d2ff, #3a7bd5);
    box-shadow: 0 6px 20px rgba(79, 172, 254, 0.4);
    transform: translateY(-2px);
}

/* Welcome Message */
.welcome-message {
    text-align: center;
    margin-top: 80px;
    margin-bottom: 20px;
    background: rgba(0, 123, 255, 0.05);
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15);
    border-left: 6px solid #007bff;
}

.welcome-text {
    font-size: 28px;
    font-weight: bold;
    color: #0034DE; /* Change to desired color, e.g., blue */
    margin: 0;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
    transition: color 0.3s ease;
}
.welcome-message:hover .welcome-text {
    color: #64DE00
; /* Hover color effect */
}

/* My Inspections Modal Styles */
.my-inspections-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
}

.my-inspections-table th,
.my-inspections-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #e0e6ed;
}

.my-inspections-table th {
    background-color: #007bff;
    font-weight: bold;
    color: white;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.my-inspections-table tr:hover {
    background-color: rgba(0, 123, 255, 0.05);
    cursor: pointer;
}

/* Status Badges */
.status-badge {
    padding: 6px 12px;
    border-radius: 15px;
    font-size: 11px;
    font-weight: bold;
    text-transform: uppercase;
    display: inline-block;
    letter-spacing: 0.5px;
}

.status-pass {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.status-fail {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.status-satisfactory {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.status-unsatisfactory {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.status-completed {
    background-color: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
}

.status-unknown {
    background-color: #e2e3e5;
    color: #383d41;
    border: 1px solid #d6d8db;
}

/* Action Buttons in My Inspections */
.action-buttons {
    white-space: nowrap;
}

.action-btn {
    padding: 6px 12px;
    margin: 0 3px;
    border: none;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    color: white;
}

.view-btn {
    background-color: #007bff;
}

.view-btn:hover {
    background-color: #0056b3;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,123,255,0.3);
}

.print-btn {
    background-color: #28a745;
}

.print-btn:hover {
    background-color: #218838;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(40,167,69,0.3);
}

.download-btn {
    background-color: #17a2b8;
}

.download-btn:hover {
    background-color: #138496;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(23,162,184,0.3);
}

.status-completed {
    background-color: #d1ecf1;
    color: #0c5460;
}

.status-satisfactory {
    background-color: #cce5ff;
    color: #004085;
}

.status-unsatisfactory {
    background-color: #f8d7da;
    color: #721c24;
}

/* Loading Spinner */
.spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #007bff;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 2s linear infinite;
    margin: 0 auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* No Inspections */
.no-inspections {
    text-align: center;
    padding: 40px;
    color: #555;
    font-style: italic;
}

/* Modal Filter */
.modal-filter {
    margin-bottom: 20px;
    padding: 12px;
    background: rgba(0, 123, 255, 0.05);
    border-radius: 8px;
    border: 1px solid #e0e6ed;
}

.modal-filter select {
    padding: 6px 12px;
    margin-right: 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    outline: none;
    transition: border 0.3s;
}

.modal-filter select:focus {
    border-color: #007bff;
    box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
}

        .logout-button, .task-button {
            padding: 12px 24px;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .logout-button {
            background: linear-gradient(135deg, #ff6b6b, #dc3545);
        }

        .logout-button:hover {
            background: linear-gradient(135deg, #dc3545, #c82333);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
            transform: translateY(-2px);
        }

        .task-button {
            background: linear-gradient(135deg, #28a745, #20c997);
            position: relative;
        }

        .task-button:hover {
            background: linear-gradient(135deg, #218838, #17a2b8);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
            transform: translateY(-2px);
        }

        .my-inspections-btn {
            padding: 12px 24px;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .my-inspections-btn:hover {
            background: linear-gradient(135deg, #1e40af, #2563eb);
            box-shadow: 0 6px 20px rgba(30, 58, 138, 0.4);
            transform: translateY(-2px);
        }

        /* Global Search Bar Styles */
        .global-search-container {
            position: relative;
            max-width: 600px;
            margin: 20px auto;
        }

        .global-search-input {
            width: 100%;
            padding: 14px 20px;
            font-size: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .global-search-input:focus {
            outline: none;
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .global-search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .global-search-suggestions.active {
            display: block;
        }

        .global-suggestion-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid #f3f4f6;
        }

        .global-suggestion-item:hover {
            background: #f9fafb;
        }

        .global-suggestion-item:last-child {
            border-bottom: none;
        }

        .task-notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff0000;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .task-notification-badge.show {
            display: flex;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-top: 60px;
        }
        .form-select {
            margin-bottom: 20px;
            text-align: center;
        }
        #form-type {
            padding: 10px;
            font-size: 16px;
            width: 300px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        .tab-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #ccc;
            flex-wrap: wrap;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            color: #666;
            transition: color 0.3s, border-bottom 0.3s;
            background: white;
            position: relative;
        }
        .tab:hover {
            color: #007bff;
        }
        .tab.active {
            color: #007bff;
            border-bottom: 2px solid #007bff;
        }
        .tab-content {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .tab-content.active {
            display: block;
        }
        h2 {
            margin-top: 0;
            color: #333;
        }
        .search-container, .residential-search-container, .burial-search-container, .spirit-licence-search-container, .swimming-pool-search-container, .small-hotels-search-container, .barbershop-search-container, .institutional-search-container, .meat-processing-search-container {
            position: relative;
            margin-bottom: 20px;
        }
        #search, #residential-search, #burial-search, #spirit-licence-search, #swimming-pool-search, #small-hotels-search, #barbershop-search, #institutional-search, #meat-processing-search {
            width: 60%;
            max-width: 400px;
            padding: 10px 40px 10px 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .search-icon, .residential-search-icon, .burial-search-icon, .spirit-licence-search-icon, .swimming-pool-search-icon, .small-hotels-search-icon, .barbershop-search-icon, .institutional-search-icon, .meat-processing-search-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: #666;
        }
        .results {
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f4f4f4;
            font-weight: bold;
        }
        tr:hover {
            background-color: #f1f1f1;
            cursor: pointer;
        }
        .overview-stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }
        .stat-card {
            background: #fff;
            padding: 20px;
            margin: 10px;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
            text-align: center;
            flex: 1;
            min-width: 200px;
        }
        .stat-card h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .stat-card p {
            font-size: 24px;
            margin: 0;
            color: #007bff;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 5px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        .modal-content h3 {
            margin-top: 0;
            color: #333;
        }
        .modal-content p {
            margin: 5px 0;
            color: #666;
        }
        .modal-content button {
            margin-top: 10px;
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Enhanced Chat System */
        .chat-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .chat-icon {
            background-color: #007bff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.5);
            transition: transform 0.3s ease;
            position: relative;
        }

        .chat-icon:hover {
            transform: scale(1.1);
        }

        /* Chat notification badge */
        .chat-notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            font-weight: bold;
            display: none;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        .chat-notification-badge.show {
            display: flex;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .chat-window {
            display: none;
            width: 350px;
            height: 450px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            flex-direction: column;
            position: absolute;
            bottom: 60px;
            right: 0;
            transition: all 0.3s ease;
        }

        .chat-window.open {
            display: flex;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-header {
            background: linear-gradient(135deg, #00b7b7, #00a0a0);
            color: white;
            padding: 15px;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .chat-header h4 {
            margin: 0;
            font-size: 16px;
        }

        .chat-controls {
            display: flex;
            gap: 10px;
        }

        .chat-control-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: background 0.3s;
        }

        .chat-control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .chat-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
        }

        .chat-footer {
            padding: 15px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
            background: white;
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 12px;
        }

        .chat-message {
            margin: 8px 0;
            padding: 10px 12px;
            border-radius: 18px;
            max-width: 80%;
            word-wrap: break-word;
            animation: fadeInMessage 0.3s ease-out;
        }

        @keyframes fadeInMessage {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-message.sent {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .chat-message.received {
            background: white;
            color: #333;
            margin-right: auto;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 5px;
        }

        .chat-message small {
            opacity: 0.7;
            font-size: 11px;
        }

        .contact-list {
            display: none;
            position: absolute;
            bottom: 60px;
            right: 0;
            width: 250px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            padding: 15px;
            z-index: 1001;
            max-height: 300px;
            overflow-y: auto;
        }

        .contact-list.open {
            display: block;
            animation: slideUp 0.3s ease-out;
        }

        .contact-list h4 {
            margin: 0 0 15px 0;
            color: #333;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 10px;
        }

        .contact-item {
            padding: 12px;
            cursor: pointer;
            border-radius: 8px;
            position: relative;
            transition: background 0.3s;
            border-bottom: 1px solid #f0f0f0;
        }

        .contact-item:hover {
            background: #f8f9fa;
        }

        .contact-item.selected {
            background: #e3f2fd;
            border-left: 3px solid #007bff;
        }

        .unread-badge {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: #ff4757;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 11px;
            font-weight: bold;
        }

        .chat-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            outline: none;
            transition: border-color 0.3s;
        }

        .chat-input:focus {
            border-color: #007bff;
        }

        .chat-send-btn {
            background: #007bff;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 10px 20px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .chat-send-btn:hover {
            background: #0056b3;
        }

        /* Loading and error states */
        .chat-loading {
            text-align: center;
            color: #999;
            padding: 20px;
            font-style: italic;
        }

        .chat-error {
            text-align: center;
            color: #e53e3e;
            background: #fed7d7;
            padding: 15px;
            border-radius: 8px;
            margin: 10px;
            font-size: 14px;
        }

        /* Minimized Chat Tabs at Bottom */
        .minimized-chats {
            position: fixed;
            bottom: 0;
            left: 20px;
            right: 20px;
            height: 60px;
            display: flex;
            align-items: flex-end;
            gap: 10px;
            z-index: 999;
            pointer-events: none;
        }

        .minimized-chat-tab {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 12px 20px;
            border-radius: 12px 12px 0 0;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 -2px 10px rgba(0, 123, 255, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 200px;
            pointer-events: auto;
            position: relative;
            animation: slideInFromBottom 0.3s ease-out;
        }

        @keyframes slideInFromBottom {
            from {
                opacity: 0;
                transform: translateY(100%);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .minimized-chat-tab:hover {
            transform: translateY(-5px);
            box-shadow: 0 -5px 15px rgba(0, 123, 255, 0.4);
        }

        .minimized-chat-tab.has-unread {
            background: linear-gradient(135deg, #ff4757, #ff3742);
            animation: pulse 2s infinite;
        }

        .minimized-chat-tab .contact-name {
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .minimized-chat-tab .unread-count {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 11px;
            font-weight: bold;
            min-width: 16px;
            text-align: center;
        }

        .minimized-chat-tab .close-tab {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 3px;
            opacity: 0.7;
            transition: all 0.3s;
        }

        .minimized-chat-tab .close-tab:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.2);
        }

        /* Task-related styles */
        .task-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
            transition: all 0.3s ease;
        }

        .task-item.pending {
            border-left: 4px solid #ffc107;
        }

        .task-item.in-progress {
            border-left: 4px solid #007bff;
        }

        .task-item.completed {
            border-left: 4px solid #28a745;
            background: #f0f8ff;
        }

        .task-item.declined {
            border-left: 4px solid #dc3545;
            background: #fff5f5;
        }

        .task-item.overdue {
            border-left: 4px solid #dc3545;
            background: #fff5f5;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .task-title {
            font-weight: bold;
            color: #333;
            margin: 0;
            font-size: 18px;
        }

        .task-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .task-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .task-status.completed {
            background: #d4edda;
            color: #155724;
        }

        .task-status.in-progress {
            background: #cce5ff;
            color: #004085;
        }

        .task-status.declined {
            background: #f8d7da;
            color: #721c24;
        }

        .task-details {
            color: #666;
            margin: 15px 0;
            line-height: 1.5;
        }

        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #999;
            margin-bottom: 15px;
        }

        .task-actions {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .task-response-buttons {
            display: flex;
            gap: 10px;
        }

        .task-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .task-btn.accept {
            background: #28a745;
            color: white;
        }

        .task-btn.accept:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        }

        .task-btn.decline {
            background: #dc3545;
            color: white;
        }

        .task-btn.decline:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3);
        }

        .task-btn.complete {
            background: #28a745;
            color: white;
        }

        .task-btn.complete:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        }

        .task-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .empty-tasks {
            text-align: center;
            color: #999;
            padding: 60px;
            font-size: 18px;
        }

        .empty-tasks i {
            font-size: 48px;
            margin-bottom: 20px;
            display: block;
        }

        /* Task Modal */
        .task-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }

        .task-modal.open {
            display: flex;
        }

        .task-modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .close-modal:hover {
            color: #333;
        }

        .status-pass {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 12px;
            text-transform: uppercase;
            display: inline-block;
            min-width: 60px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(40, 167, 69, 0.3);
            border: none;
            cursor: default;
            transition: all 0.3s ease;
        }

        .status-pass:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.4);
        }

        .status-fail {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 12px;
            text-transform: uppercase;
            display: inline-block;
            min-width: 60px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(220, 53, 69, 0.3);
            border: none;
            cursor: default;
            transition: all 0.3s ease;
        }

        .status-fail:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(220, 53, 69, 0.4);
        }

        .status-completed {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 12px;
            text-transform: uppercase;
            display: inline-block;
            min-width: 80px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 123, 255, 0.3);
            border: none;
            cursor: default;
            transition: all 0.3s ease;
        }

        .status-completed:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.4);
        }

        .status-unknown, .status-na {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 12px;
            text-transform: uppercase;
            display: inline-block;
            min-width: 70px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(108, 117, 125, 0.3);
            border: none;
            cursor: default;
            transition: all 0.3s ease;
        }

        .status-unknown:hover, .status-na:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(108, 117, 125, 0.4);
        }

        /* Dark Theme Styles - Comprehensive Coverage */
        :root {
            --bg-color: url('{{ url_for("static", filename="d.jpg") }}');
            --container-bg: rgba(255, 255, 255, 0.95);
            --text-color: #333;
            --card-bg: white;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --welcome-bg: rgba(0, 123, 255, 0.05);
            --welcome-border: #007bff;
            --welcome-text: #0034DE;
            --welcome-hover: #64DE00;
            --form-bg: rgba(255, 255, 255, 0.95);
            --border-color: #e0e6ed;
        }

        /* ========== RESPONSIVE STYLES FOR MOBILE & TABLET ========== */

        /* Mobile devices (up to 768px) */
        @media only screen and (max-width: 768px) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }

            .container {
                width: 100%;
                padding: 10px;
            }

            /* Header buttons - stack vertically on mobile */
            .header-buttons {
                position: relative;
                top: 10px;
                left: 10px;
                flex-direction: column;
                gap: 10px;
                width: calc(100% - 20px);
            }

            .logout-button, .task-button, .my-inspections-btn, .my-inspections-button {
                width: 100%;
                padding: 10px 16px;
                font-size: 13px;
                margin: 0;
            }

            /* Header logo - smaller and repositioned */
            .header-logo {
                position: relative;
                top: 0;
                right: 0;
                text-align: center;
                margin: 15px 0;
            }

            .header-logo img {
                height: 70px;
            }

            /* Welcome message */
            .welcome-message {
                margin-top: 20px;
                padding: 15px;
            }

            .welcome-text {
                font-size: 20px;
            }

            /* Search container */
            .global-search-container {
                max-width: 100%;
                margin: 15px auto;
            }

            .global-search-input {
                padding: 12px 15px;
                font-size: 14px;
            }

            /* Form select dropdown */
            #form-type {
                width: 100%;
                max-width: 100%;
                font-size: 14px;
                padding: 8px;
            }

            /* Tab container */
            .tab-container {
                flex-wrap: wrap;
                justify-content: flex-start;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .tab {
                padding: 8px 12px;
                font-size: 12px;
                white-space: nowrap;
            }

            /* Tab content */
            .tab-content {
                padding: 15px 10px;
            }

            /* Overview stats - stack cards */
            .overview-stats {
                flex-direction: column;
            }

            .stat-card {
                min-width: 100%;
                margin: 5px 0;
            }

            .stat-card h3 {
                font-size: 14px;
            }

            .stat-card p {
                font-size: 20px;
            }

            /* Search inputs */
            #search, #residential-search, #burial-search, #spirit-licence-search,
            #swimming-pool-search, #small-hotels-search, #barbershop-search,
            #institutional-search, #meat-processing-search {
                width: 100%;
                max-width: 100%;
                font-size: 14px;
                padding: 10px;
            }

            /* Tables - responsive scrolling */
            .results {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            table {
                font-size: 12px;
                min-width: 600px;
            }

            th, td {
                padding: 8px 5px;
            }

            /* Modal adjustments */
            .modal-content {
                width: 95%;
                padding: 15px;
                max-height: 85vh;
            }

            .modal-content h3 {
                font-size: 18px;
            }

            /* My Inspections table */
            .my-inspections-table {
                font-size: 11px;
                min-width: 600px;
            }

            .my-inspections-table th,
            .my-inspections-table td {
                padding: 8px 5px;
            }

            .action-btn {
                padding: 5px 8px;
                font-size: 10px;
                margin: 2px;
            }

            /* Status badges */
            .status-badge, .status-pass, .status-fail, .status-completed,
            .status-satisfactory, .status-unsatisfactory, .status-unknown {
                padding: 5px 10px;
                font-size: 10px;
            }

            h1 {
                font-size: 22px;
                margin-top: 20px;
            }

            h2 {
                font-size: 18px;
            }
        }

        /* Tablet devices (769px to 1024px) */
        @media only screen and (min-width: 769px) and (max-width: 1024px) {
            .container {
                width: 95%;
                padding: 15px;
            }

            .header-buttons {
                top: 15px;
                left: 15px;
                gap: 15px;
            }

            .logout-button, .task-button, .my-inspections-btn {
                padding: 10px 20px;
                font-size: 13px;
            }

            .header-logo img {
                height: 90px;
            }

            .welcome-text {
                font-size: 24px;
            }

            .tab {
                padding: 10px 15px;
                font-size: 13px;
            }

            .overview-stats {
                justify-content: space-between;
            }

            .stat-card {
                min-width: 45%;
                flex: 0 0 45%;
            }

            #form-type {
                width: 80%;
            }

            table {
                font-size: 13px;
            }

            th, td {
                padding: 9px;
            }
        }

        /* Landscape orientation on mobile */
        @media only screen and (max-width: 896px) and (orientation: landscape) {
            .header-logo img {
                height: 50px;
            }

            .welcome-message {
                margin-top: 10px;
                padding: 10px;
            }

            .welcome-text {
                font-size: 18px;
            }

            .header-buttons {
                flex-direction: row;
                flex-wrap: wrap;
            }

            .logout-button, .task-button, .my-inspections-btn {
                width: auto;
                flex: 1;
                min-width: 100px;
            }
        }

        /* iOS specific - handle notch and safe areas */
        @supports (padding: max(0px)) {
            body {
                padding-top: max(20px, env(safe-area-inset-top));
                padding-left: env(safe-area-inset-left);
                padding-right: env(safe-area-inset-right);
                padding-bottom: max(20px, env(safe-area-inset-bottom));
            }
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header-buttons">
    <form method="POST" action="/logout" style="display: inline;">
        <button type="submit" class="logout-button">Logout</button>
    </form>
    <button class="task-button" onclick="openTaskModal()">
        Tasks
        <span id="task-notification-badge" class="task-notification-badge"></span>
    </button>
    <button class="my-inspections-btn" onclick="openMyInspectionsModal()">
        My Inspections
    </button>
</div>

        <div class="header-logo">
            <img src="{{ url_for('static', filename='wrha.PNG') }}" alt="WRHA Logo">
        </div>

        <div class="welcome-message">
            <h1 class="welcome-text" id="welcomeTitle">Inspector Dashboard{% if admin_mode %} - ADMIN INSPECTOR MODE{% endif %}</h1>
            {% if admin_mode %}
            <div style="margin-top: 15px;">
                <a href="/admin/exit_inspector_mode" style="display: inline-block; padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);">
                    ‚Üê Back to Admin Dashboard
                </a>
            </div>
            {% endif %}
        </div>

        <!-- Global Search Bar -->
        <div class="global-search-container">
            <input
                type="text"
                id="globalSearchInput"
                placeholder="üîç Search by establishment name, owner, or license holder..."
                class="global-search-input"
                autocomplete="off"
            >
            <div id="globalSearchSuggestions" class="global-search-suggestions"></div>
        </div>

        <div class="form-select">
            <select id="form-type">
                <option value="" selected>Select a Form</option>
                <option value="/new_form">Food Establishment Inspection Form</option>
                <option value="/new_small_hotels_form">Small Hotels Inspection Form</option>
                <option value="/new_residential_form">Residential & Non-Residential Inspection Form</option>
                <option value="/new_burial_form">Burial Site Inspection Form</option>
                <option value="/new_spirit_licence_form">Spirit Licence Premises Inspection Form</option>
                <option value="/new_swimming_pool_form">Swimming Pool Inspection Form</option>
                <option value="/new_barbershop_form">Barbershop & Beauty Salon Inspection Form</option>
                <option value="/new_institutional_form">Institutional Health Inspection Form</option>
                <option value="/new_meat_processing_form">Meat Processing Plant & Slaughter Place Inspection Form</option>
            </select>
        </div>
        <div class="tab-container">
            <div class="tab active" data-tab="overview">Overview</div>
            <div class="tab" data-tab="food">Food Inspection</div>
            <div class="tab" data-tab="residential">Residential Inspection</div>
            <div class="tab" data-tab="burial">Burial Inspection</div>
            <div class="tab" data-tab="spirit_licence">Spirit Licence Inspection</div>
            <div class="tab" data-tab="swimming_pool">Swimming Pool Inspection</div>
            <div class="tab" data-tab="small_hotels">Small Hotels Inspection</div>
            <div class="tab" data-tab="barbershop">Barbershop & Beauty Salon</div>
            <div class="tab" data-tab="institutional">Institutional Health</div>
            <div class="tab" data-tab="meat_processing">Meat Processing Inspection</div>
        </div>

        <div class="tab-content active" id="overview">
            <h2>Overview</h2>
            <div class="overview-stats">
                <div class="stat-card">
                    <h3>Total Inspections</h3>
                    <p id="total-inspections">0</p>
                </div>
                <div class="stat-card">
                    <h3>Food Inspections</h3>
                    <p id="food-inspections">0</p>
                </div>
                <div class="stat-card">
                    <h3>Residential Inspections</h3>
                    <p id="residential-inspections">0</p>
                </div>
                <div class="stat-card">
                    <h3>Burial Inspections</h3>
                    <p id="burial-inspections">0</p>
                </div>
                <div class="stat-card">
                    <h3>Spirit Licence Inspections</h3>
                    <p id="spirit-licence-inspections">0</p>
                </div>
                <div class="stat-card">
                    <h3>Swimming Pool Inspections</h3>
                    <p id="swimming-pool-inspections">0</p>
                </div>
                <div class="stat-card">
                    <h3>Small Hotels Inspections</h3>
                    <p id="small-hotels-inspections">0</p>
                </div>
                <div class="stat-card">
                    <h3>Barbershop & Beauty Salon Inspections</h3>
                    <p id="barbershop-inspections">0</p>
                </div>
                <div class="stat-card">
    <h3>Institutional Health Inspections</h3>
    <p id="institutional-inspections">0</p>
</div>
                <div class="stat-card">
    <h3>Meat Processing Inspections</h3>
    <p id="meat-processing-inspections">0</p>
</div>
            </div>
        </div>

        <div class="tab-content" id="food">
            <h2>Food Establishment Inspection Forms</h2>
            <div class="search-container">
                <input type="text" id="search" placeholder="Search completed food establishment forms...">
                <span class="search-icon">üîç</span>
            </div>
            <div class="results" id="food-results">
                <table>
                    <thead>
                        <tr>
                            <th>Form ID</th>
                            <th>Establishment Name</th>
                            <th>Date Completed</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="food-results-body"></tbody>
                </table>
            </div>
        </div>

        <div class="tab-content" id="residential">
            <h2>Residential & Non-Residential Inspection Forms</h2>
            <div class="residential-search-container">
                <input type="text" id="residential-search" placeholder="Search by Name of Premises or Owner/Agent/Occupier...">
                <span class="residential-search-icon">üîç</span>
            </div>
            <div class="results" id="residential-results">
                <table>
                    <thead>
                        <tr>
                            <th>Form ID</th>
                            <th>Name of Premises</th>
                            <th>Owner/Agent/Occupier</th>
                            <th>Date Completed</th>
                            <th>Result</th>
                        </tr>
                    </thead>
                    <tbody id="residential-results-body"></tbody>
                </table>
            </div>
        </div>

        <div class="tab-content" id="burial">
            <h2>Burial Site Inspection Forms</h2>
            <div class="burial-search-container">
                <input type="text" id="burial-search" placeholder="Search completed burial forms...">
                <span class="burial-search-icon">üîç</span>
            </div>
            <div class="results" id="burial-results">
                <table>
                    <thead>
                        <tr>
                            <th>Form ID</th>
                            <th>Applicant Name</th>
                            <th>Deceased Name</th>
                            <th>Date Completed</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="burial-results-body"></tbody>
                </table>
            </div>
        </div>

        <div class="tab-content" id="spirit_licence">
            <h2>Spirit Licence Premises Inspection Forms</h2>
            <div class="spirit-licence-search-container">
                <input type="text" id="spirit-licence-search" placeholder="Search completed spirit licence forms...">
                <span class="spirit-licence-search-icon">üîç</span>
            </div>
            <div class="results" id="spirit-licence-results">
                <table>
                    <thead>
                        <tr>
                            <th>Form ID</th>
                            <th>Establishment Name</th>
                            <th>Date Completed</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="spirit-licence-results-body"></tbody>
                </table>
            </div>
        </div>

        <div class="tab-content" id="swimming_pool">
            <h2>Swimming Pool Inspection Forms</h2>
            <div class="swimming-pool-search-container">
                <input type="text" id="swimming-pool-search" placeholder="Search completed swimming pool forms...">
                <span class="swimming-pool-search-icon">üîç</span>
            </div>
            <div class="results" id="swimming-pool-results">
                <table>
                    <thead>
                        <tr>
                            <th>Form ID</th>
                            <th>Establishment Name</th>
                            <th>Date Completed</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="swimming-pool-results-body"></tbody>
                </table>
            </div>
        </div>

        <div class="tab-content" id="small_hotels">
            <h2>Small Hotels Inspection Forms</h2>
            <div class="small-hotels-search-container">
                <input type="text" id="small-hotels-search" placeholder="Search completed small hotels forms...">
                <span class="small-hotels-search-icon">üîç</span>
            </div>
            <div class="results" id="small-hotels-results">
                <table>
                    <thead>
                        <tr>
                            <th>Form ID</th>
                            <th>Establishment Name</th>
                            <th>Date Completed</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="small-hotels-results-body"></tbody>
                </table>
            </div>
        </div>

        <div class="tab-content" id="barbershop">
            <h2>Barbershop & Beauty Salon Inspection Forms</h2>
            <div class="barbershop-search-container">
                <input type="text" id="barbershop-search" placeholder="Search completed barbershop forms...">
                <span class="barbershop-search-icon">üîç</span>
            </div>
            <div class="results" id="barbershop-results">
                <table>
                    <thead>
                        <tr>
                            <th>Form ID</th>
                            <th>Establishment Name</th>
                            <th>Date Completed</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="barbershop-results-body"></tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="tab-content" id="institutional">
    <h2>Institutional Health Inspection Forms</h2>
    <div class="institutional-search-container">
        <input type="text" id="institutional-search" placeholder="Search completed institutional forms...">
        <span class="institutional-search-icon">üîç</span>
    </div>
    <div class="results" id="institutional-results">
        <table>
            <thead>
                <tr>
                    <th>Form ID</th>
                    <th>Establishment Name</th>
                    <th>Date Completed</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="institutional-results-body"></tbody>
        </table>
    </div>
</div>

    <div class="tab-content" id="meat_processing">
    <h2>Meat Processing & Slaughter Place Inspection Forms</h2>
    <div class="meat-processing-search-container">
        <input type="text" id="meat-processing-search" placeholder="Search completed meat processing forms...">
        <span class="meat-processing-search-icon">üîç</span>
    </div>
    <div class="results" id="meat-processing-results">
        <table>
            <thead>
                <tr>
                    <th>Form ID</th>
                    <th>Establishment Name</th>
                    <th>Date Completed</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="meat-processing-results-body"></tbody>
        </table>
    </div>
</div>

    <!-- Task Modal -->
    <div class="task-modal" id="taskModal">
        <div class="task-modal-content">
            <span class="close-modal" onclick="closeTaskModal()">&times;</span>
            <h2>My Tasks</h2>
            <div id="tasks-loading" style="display: none;">
                <p>Loading tasks...</p>
            </div>
            <div id="tasks-container">
                <!-- Tasks will be loaded here -->
            </div>
        </div>
    </div>


    <!-- My Inspections Modal -->
<div class="task-modal" id="myInspectionsModal">
    <div class="task-modal-content">
        <span class="close-modal" onclick="closeMyInspectionsModal()">&times;</span>
        <h2>My Inspections</h2>
        <div id="my-inspections-loading" style="display: none;">
            <p>Loading your inspections...</p>
        </div>
        <div class="tab-container" style="margin-bottom: 20px;">
            <div class="tab active" data-inspection-tab="all">All</div>
            <div class="tab" data-inspection-tab="food">Food</div>
            <div class="tab" data-inspection-tab="residential">Residential</div>
            <div class="tab" data-inspection-tab="burial">Burial</div>
            <div class="tab" data-inspection-tab="spirit_licence">Spirit Licence</div>
            <div class="tab" data-inspection-tab="swimming_pool">Swimming Pool</div>
            <div class="tab" data-inspection-tab="small_hotels">Small Hotels</div>
            <div class="tab" data-inspection-tab="barbershop">Barbershop</div>
            <div class="tab" data-inspection-tab="institutional">Institutional</div>
        </div>
        <div id="my-inspections-container">
            <!-- My inspections will be loaded here -->
        </div>
    </div>
</div>

    <div class="modal" id="inspectionModal">
        <div class="modal-content">
            <h3>Inspection Details</h3>
            <div id="inspectionDetails"></div>
            <button onclick="document.getElementById('inspectionModal').style.display='none'">Close</button>
        </div>
    </div>

    <!-- Enhanced Chat System -->
    <div class="chat-container">
        <div class="chat-icon" onclick="toggleChat()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <div id="chatNotificationBadge" class="chat-notification-badge">0</div>
        </div>

        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                <h4 id="chatTitle">Select a Contact</h4>
                <div class="chat-controls">
                    <button class="chat-control-btn" onclick="minimizeChat()" title="Minimize">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                    <button class="chat-control-btn" onclick="closeChat()" title="Close">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="chat-body" id="chatBody">
                <div id="messageArea">
                    <div style="text-align: center; color: #999; padding: 40px;">
                        Select a contact from the list below to start chatting
                    </div>
                </div>
            </div>

            <div class="chat-footer">
                <input type="text" class="chat-input" id="chatInput" placeholder="Type a message..." disabled>
                <button class="chat-send-btn" onclick="sendMessage()">Send</button>
            </div>
        </div>

        <div class="contact-list" id="contactList">
            <h4>Contacts</h4>
            <div id="contactItems">
                <!-- Contacts will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Minimized Chat Tabs Container -->
    <div class="minimized-chats" id="minimizedChats">
        <!-- Minimized chat tabs will appear here -->
    </div>

    <footer>
        <a href="https://www.wrha.gov.jm/parishes/westmoreland/" target="_blank" style="color: #007bff;">Connect on WRHA</a>
    </footer>

    <script>
        document.querySelector('#form-type').addEventListener('change', function() {
            if (this.value) {
                window.location.href = this.value;
            }
        });

        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                tab.classList.add('active');
                document.querySelector(`#${tab.dataset.tab}`).classList.add('active');
                loadForms(tab.dataset.tab);
            });
        });

        // FIXED CHAT SYSTEM VARIABLES
        let currentContactId = null;
        let currentContactName = null;
        let minimizedChats = new Map(); // Store minimized chat data
        let pollingInterval = null;
        let isContactListOpen = false;

        // Global cache for all form data
        let allFormsData = {
            food: [],
            residential: [],
            burial: [],
            spirit_licence: [],
            swimming_pool: [],
            small_hotels: [],
            barbershop: [],
            institutional: [],
            meat_processing: []
        };

        // Enhanced Search System - Load all data once and filter locally
        async function loadAllFormsData() {
            const formTypes = ['food', 'residential', 'burial', 'spirit_licence', 'swimming_pool', 'small_hotels', 'barbershop', 'institutional', 'meat_processing'];

            for (const formType of formTypes) {
                try {
                    const response = await fetch(`/search_forms?query=&type=${formType}`);
                    const data = await response.json();
                    allFormsData[formType] = data.forms || [];
                } catch (error) {
                    console.error(`Error loading ${formType} forms:`, error);
                    allFormsData[formType] = [];
                }
            }
        }

        // Predictive search function with fuzzy matching
        function predictiveSearch(query, formType) {
            if (!query || query.length < 1) {
                return allFormsData[formType];
            }

            const searchTerm = query.toLowerCase().trim();
            const forms = allFormsData[formType];

            return forms.filter(form => {
                // Create searchable text based on form type
                let searchableText = '';

                switch (formType) {
                    case 'food':
                        searchableText = `${form.establishment_name || ''} ${form.id || ''} ${form.result || ''} ${form.status || ''}`.toLowerCase();
                        break;
                    case 'residential':
                        searchableText = `${form.premises_name || ''} ${form.owner || ''} ${form.id || ''} ${form.result || ''}`.toLowerCase();
                        break;
                    case 'burial':
                        searchableText = `${form.applicant_name || ''} ${form.deceased_name || ''} ${form.id || ''} ${form.status || ''}`.toLowerCase();
                        break;
                    case 'spirit_licence':
                        searchableText = `${form.establishment_name || ''} ${form.id || ''} ${form.result || ''} ${form.status || ''}`.toLowerCase();
                        break;
                    case 'swimming_pool':
                        searchableText = `${form.establishment_name || ''} ${form.id || ''} ${form.result || ''} ${form.status || ''}`.toLowerCase();
                        break;
                    case 'small_hotels':
                        searchableText = `${form.establishment_name || ''} ${form.id || ''} ${form.result || ''} ${form.status || ''}`.toLowerCase();
                        break;
                    case 'barbershop':
                        searchableText = `${form.establishment_name || ''} ${form.id || ''} ${form.result || ''} ${form.status || ''}`.toLowerCase();
                        break;
                }

                // Exact match gets highest priority
                if (searchableText.includes(searchTerm)) {
                    return true;
                }

                // Fuzzy matching for typos and partial matches
                const words = searchTerm.split(' ').filter(word => word.length > 0);
                return words.some(word => {
                    // Check if any word in searchableText starts with the search word
                    const searchableWords = searchableText.split(' ');
                    return searchableWords.some(searchWord =>
                        searchWord.startsWith(word) ||
                        // Allow for one character difference (simple fuzzy matching)
                        (word.length > 2 && searchWord.length > 2 && levenshteinDistance(word, searchWord.substring(0, word.length + 1)) <= 1)
                    );
                });
            }).sort((a, b) => {
                // Sort by relevance - exact matches first, then partial matches
                const aText = getSearchableText(a, formType).toLowerCase();
                const bText = getSearchableText(b, formType).toLowerCase();

                const aExact = aText.includes(searchTerm);
                const bExact = bText.includes(searchTerm);

                if (aExact && !bExact) return -1;
                if (!aExact && bExact) return 1;

                // If both are exact or both are partial, sort alphabetically
                return aText.localeCompare(bText);
            });
        }

        // Helper function to get searchable text
        function getSearchableText(form, formType) {
            switch (formType) {
                case 'food':
                    return form.establishment_name || '';
                case 'residential':
                    return `${form.premises_name || ''} ${form.owner || ''}`;
                case 'burial':
                    return `${form.applicant_name || ''} ${form.deceased_name || ''}`;
                case 'spirit_licence':
                case 'swimming_pool':
                case 'small_hotels':
                case 'barbershop':
                    return form.establishment_name || '';
                default:
                    return '';
            }
        }

        // Simple Levenshtein distance for fuzzy matching
        function levenshteinDistance(str1, str2) {
            const matrix = [];
            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }
            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            return matrix[str2.length][str1.length];
        }

        // Enhanced search event listeners with predictive functionality
        function setupSearchListeners() {
            // Food search
            document.querySelector('#search').addEventListener('input', function() {
                const query = this.value.trim();
                const filteredForms = predictiveSearch(query, 'food');
                displaySearchResults(filteredForms, 'food');
            });

            // Residential search
            document.querySelector('#residential-search').addEventListener('input', function() {
                const query = this.value.trim();
                const filteredForms = predictiveSearch(query, 'residential');
                displaySearchResults(filteredForms, 'residential');
            });

            // Burial search
            document.querySelector('#burial-search').addEventListener('input', function() {
                const query = this.value.trim();
                const filteredForms = predictiveSearch(query, 'burial');
                displaySearchResults(filteredForms, 'burial');
            });

            // Spirit licence search
            document.querySelector('#spirit-licence-search').addEventListener('input', function() {
                const query = this.value.trim();
                const filteredForms = predictiveSearch(query, 'spirit_licence');
                displaySearchResults(filteredForms, 'spirit_licence');
            });

            // Swimming pool search
            document.querySelector('#swimming-pool-search').addEventListener('input', function() {
                const query = this.value.trim();
                const filteredForms = predictiveSearch(query, 'swimming_pool');
                displaySearchResults(filteredForms, 'swimming_pool');
            });

            // Small hotels search
            document.querySelector('#small-hotels-search').addEventListener('input', function() {
                const query = this.value.trim();
                const filteredForms = predictiveSearch(query, 'small_hotels');
                displaySearchResults(filteredForms, 'small_hotels');
            });

            // Barbershop search
            document.querySelector('#barbershop-search').addEventListener('input', function() {
                const query = this.value.trim();
                const filteredForms = predictiveSearch(query, 'barbershop');
                displaySearchResults(filteredForms, 'barbershop');
            });

            // Institutional search
            document.querySelector('#institutional-search').addEventListener('input', function() {
                const query = this.value.trim();
                const filteredForms = predictiveSearch(query, 'institutional');
                displaySearchResults(filteredForms, 'institutional');
            });

            // Meat processing search
            document.querySelector('#meat-processing-search').addEventListener('input', function() {
                const query = this.value.trim();
                const filteredForms = predictiveSearch(query, 'meat_processing');
                displaySearchResults(filteredForms, 'meat_processing');
            });
        }

        // Display search results function
        function displaySearchResults(forms, formType) {
            let tbody;
            switch (formType) {
                case 'food':
                    tbody = document.querySelector('#food-results-body');
                    break;
                case 'residential':
                    tbody = document.querySelector('#residential-results-body');
                    break;
                case 'burial':
                    tbody = document.querySelector('#burial-results-body');
                    break;
                case 'spirit_licence':
                    tbody = document.querySelector('#spirit-licence-results-body');
                    break;
                case 'swimming_pool':
                    tbody = document.querySelector('#swimming-pool-results-body');
                    break;
                case 'small_hotels':
                    tbody = document.querySelector('#small-hotels-results-body');
                    break;
                case 'barbershop':
                    tbody = document.querySelector('#barbershop-results-body');
                    break;
                case 'institutional':
                    tbody = document.querySelector('#institutional-results-body');
                    break;
                case 'meat_processing':
                    tbody = document.querySelector('#meat-processing-results-body');
                    break;
                default:
                    return;
            }

            tbody.innerHTML = '';

            if (forms && forms.length > 0) {
                forms.forEach(form => {
                    const row = document.createElement('tr');

                    // Function to get status with styling
                    function getStyledStatus(status) {
                        if (!status || status === 'N/A') return '<span class="status-unknown">Unknown</span>';

                        const statusLower = status.toLowerCase();
                        let cssClass = '';

                        if (statusLower === 'pass') {
                            cssClass = 'status-pass';
                        } else if (statusLower === 'fail') {
                            cssClass = 'status-fail';
                        } else if (statusLower === 'completed') {
                            cssClass = 'status-completed';
                        } else {
                            cssClass = 'status-unknown';
                        }

                        return `<span class="${cssClass}">${status}</span>`;
                    }

                    if (formType === 'burial') {
                        row.innerHTML = `
                            <td>${form.id}</td>
                            <td>${form.applicant_name || 'N/A'}</td>
                            <td>${form.deceased_name || 'N/A'}</td>
                            <td>${form.created_at || 'N/A'}</td>
                            <td>${getStyledStatus(form.status || form.result)}</td>
                        `;
                        row.addEventListener('click', () => {
                            window.location.href = `/burial/inspection/${form.id}`;
                        });
                    } else if (formType === 'residential') {
                        row.innerHTML = `
                            <td>${form.id}</td>
                            <td>${form.premises_name || 'N/A'}</td>
                            <td>${form.owner || 'N/A'}</td>
                            <td>${form.created_at || 'N/A'}</td>
                            <td>${getStyledStatus(form.status || form.result)}</td>
                        `;
                        row.addEventListener('click', () => {
                            window.location.href = `/residential/inspection/${form.id}`;
                        });
                    } else if (formType === 'swimming_pool') {
                        row.innerHTML = `
                            <td>${form.id}</td>
                            <td>${form.establishment_name || 'N/A'}</td>
                            <td>${form.created_at || 'N/A'}</td>
                            <td>${getStyledStatus(form.status || form.result)}</td>
                        `;
                        row.addEventListener('click', () => {
                            window.location.href = `/swimming_pool/inspection/${form.id}`;
                        });
                    } else if (formType === 'spirit_licence') {
                        row.innerHTML = `
                            <td>${form.id}</td>
                            <td>${form.establishment_name || 'N/A'}</td>
                            <td>${form.created_at || 'N/A'}</td>
                            <td>${getStyledStatus(form.status || form.result)}</td>
                        `;
                        row.addEventListener('click', () => {
                            window.location.href = `/spirit_licence/inspection/${form.id}`;
                        });
                    } else if (formType === 'small_hotels') {
                        row.innerHTML = `
                            <td>${form.id}</td>
                            <td>${form.establishment_name || 'N/A'}</td>
                            <td>${form.created_at || 'N/A'}</td>
                            <td>${getStyledStatus(form.status || form.result)}</td>
                        `;
                        row.addEventListener('click', () => {
                            window.location.href = `/small_hotels/inspection/${form.id}`;
                        });
                    } else if (formType === 'barbershop') {
                        row.innerHTML = `
                            <td>${form.id}</td>
                            <td>${form.establishment_name || 'N/A'}</td>
                            <td>${form.created_at || 'N/A'}</td>
                            <td>${getStyledStatus(form.status || form.result)}</td>
                        `;
                        row.addEventListener('click', () => {
                            window.location.href = `/barbershop/inspection/${form.id}`;
                        });
                    } else if (formType === 'institutional') {
                        row.innerHTML = `
                            <td>${form.id}</td>
                            <td>${form.establishment_name || 'N/A'}</td>
                            <td>${form.created_at || 'N/A'}</td>
                            <td>${getStyledStatus(form.status || form.result)}</td>
                        `;
                        row.addEventListener('click', () => {
                            window.location.href = `/institutional/inspection/${form.id}`;
                        });
                    } else if (formType === 'meat_processing') {
                        row.innerHTML = `
                            <td>${form.id}</td>
                            <td>${form.establishment_name || 'N/A'}</td>
                            <td>${form.created_at || 'N/A'}</td>
                            <td>${getStyledStatus(form.status || form.result)}</td>
                        `;
                        row.addEventListener('click', () => {
                            window.location.href = `/meat_processing/inspection/${form.id}`;
                        });
                    } else {
                        // This is the food establishment case
                        row.innerHTML = `
                            <td>${form.id}</td>
                            <td>${form.establishment_name || 'N/A'}</td>
                            <td>${form.created_at || 'N/A'}</td>
                            <td>${getStyledStatus(form.status || form.result)}</td>
                        `;
                        row.addEventListener('click', () => {
                            window.location.href = `/inspection/${form.id}`;
                        });
                    }
                    tbody.appendChild(row);
                });
            } else {
                tbody.innerHTML = '<tr><td colspan="5">No results found</td></tr>';
            }
        }

        // FIXED CHAT FUNCTIONS
        function toggleChat() {
            const chatWindow = document.getElementById('chatWindow');
            const contactList = document.getElementById('contactList');

            if (chatWindow.classList.contains('open')) {
                closeChat();
            } else {
                chatWindow.classList.add('open');
                loadContacts();
                startPolling();
            }
        }

        function closeChat() {
            const chatWindow = document.getElementById('chatWindow');
            const contactList = document.getElementById('contactList');

            chatWindow.classList.remove('open');
            contactList.classList.remove('open');
            stopPolling();

            // Reset chat state
            currentContactId = null;
            currentContactName = null;
            document.getElementById('chatTitle').textContent = 'Select a Contact';
            document.getElementById('messageArea').innerHTML = `
                <div style="text-align: center; color: #999; padding: 40px;">
                    Select a contact from the list below to start chatting
                </div>
            `;
            document.getElementById('chatInput').disabled = true;
        }

        function minimizeChat() {
            if (!currentContactId || !currentContactName) {
                showNotification('No active chat to minimize', 'warning');
                return;
            }

            // Store the current chat state
            const messageArea = document.getElementById('messageArea');
            const messages = Array.from(messageArea.children).map(msg => msg.outerHTML);

            minimizedChats.set(currentContactId, {
                id: currentContactId,
                name: currentContactName,
                messages: messages,
                unreadCount: 0,
                lastActivity: new Date()
            });

            // Create minimized tab
            createMinimizedChatTab(currentContactId, currentContactName);

            // Close the main chat window
            closeChat();

            showNotification(`Chat with ${currentContactName} minimized`, 'success');
        }

        function createMinimizedChatTab(contactId, contactName) {
            const minimizedChatsContainer = document.getElementById('minimizedChats');

            // Remove existing tab if present
            const existingTab = document.querySelector(`[data-contact-id="${contactId}"]`);
            if (existingTab) {
                existingTab.remove();
            }

            const chatTab = document.createElement('div');
            chatTab.className = 'minimized-chat-tab';
            chatTab.dataset.contactId = contactId;

            const chatData = minimizedChats.get(contactId);
            const hasUnread = chatData && chatData.unreadCount > 0;

            if (hasUnread) {
                chatTab.classList.add('has-unread');
            }

            chatTab.innerHTML = `
                <div class="contact-name">${contactName}</div>
                ${hasUnread ? `<div class="unread-count">${chatData.unreadCount}</div>` : ''}
                <button class="close-tab" onclick="closeMinimizedChat('${contactId}')" title="Close chat">√ó</button>
            `;

            // Click to restore chat
            chatTab.addEventListener('click', (e) => {
                if (!e.target.classList.contains('close-tab')) {
                    restoreMinimizedChat(contactId);
                }
            });

            minimizedChatsContainer.appendChild(chatTab);
        }

        function restoreMinimizedChat(contactId) {
            const chatData = minimizedChats.get(contactId);
            if (!chatData) return;

            // Remove the minimized tab
            const tab = document.querySelector(`[data-contact-id="${contactId}"]`);
            if (tab) {
                tab.remove();
            }

            // Open the chat window
            const chatWindow = document.getElementById('chatWindow');
            chatWindow.classList.add('open');

            // Restore chat state
            currentContactId = contactId;
            currentContactName = chatData.name;
            document.getElementById('chatTitle').textContent = `Chat with ${chatData.name}`;
            document.getElementById('chatInput').disabled = false;

            // Restore messages
            const messageArea = document.getElementById('messageArea');
            messageArea.innerHTML = chatData.messages.join('');
            messageArea.scrollTop = messageArea.scrollHeight;

            // Reset unread count
            chatData.unreadCount = 0;
            minimizedChats.set(contactId, chatData);

            // Start polling
            startPolling();

            showNotification(`Chat with ${chatData.name} restored`, 'success');
        }

        function closeMinimizedChat(contactId) {
            const tab = document.querySelector(`[data-contact-id="${contactId}"]`);
            if (tab) {
                tab.style.animation = 'slideInFromBottom 0.3s ease-out reverse';
                setTimeout(() => {
                    tab.remove();
                    minimizedChats.delete(contactId);
                }, 300);
            }
        }

        // FIXED LOAD CONTACTS WITH ERROR HANDLING
        async function loadContacts() {
            try {
                const response = await fetch('/api/admin/users');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const contacts = await response.json();
                console.log('Contacts loaded:', contacts);

                const contactItems = document.getElementById('contactItems');
                contactItems.innerHTML = '';

                if (contacts.length === 0) {
                    contactItems.innerHTML = '<div class="contact-item">No contacts available</div>';
                    return;
                }

                contacts.forEach(contact => {
                    const div = document.createElement('div');
                    div.className = `contact-item ${currentContactId === contact.id ? 'selected' : ''}`;
                    div.dataset.contactId = contact.id;
                    div.textContent = contact.username;

                    if (contact.unread_count > 0) {
                        const badge = document.createElement('span');
                        badge.className = 'unread-badge';
                        badge.textContent = contact.unread_count;
                        div.appendChild(badge);
                    }

                    div.onclick = () => openChatWith(contact.id, contact.username);
                    contactItems.appendChild(div);
                });

                document.getElementById('contactList').classList.add('open');
                isContactListOpen = true;

            } catch (error) {
                console.error('Error loading contacts:', error);

                // Show error with fallback to demo data
                const contactItems = document.getElementById('contactItems');
                contactItems.innerHTML = `
                    <div class="chat-error">
                        API unavailable. Loading demo contacts...
                    </div>
                `;

                // Load demo contacts after a brief delay
                setTimeout(() => {
                    loadDemoContacts();
                }, 1500);
            }
        }

        // Load demo contacts for testing
        function loadDemoContacts() {
            console.log('Loading demo contacts...');

            const demoContacts = [
                {
                    id: 1,
                    username: 'admin_james',
                    role: 'admin',
                    unread_count: 2
                },
                {
                    id: 2,
                    username: 'admin_sarah',
                    role: 'admin',
                    unread_count: 0
                },
                {
                    id: 3,
                    username: 'medical_officer_mike',
                    role: 'medical_officer',
                    unread_count: 1
                }
            ];

            const contactItems = document.getElementById('contactItems');
            contactItems.innerHTML = '';

            demoContacts.forEach(contact => {
                const div = document.createElement('div');
                div.className = `contact-item ${currentContactId === contact.id ? 'selected' : ''}`;
                div.dataset.contactId = contact.id;
                div.textContent = contact.username;

                if (contact.unread_count > 0) {
                    const badge = document.createElement('span');
                    badge.className = 'unread-badge';
                    badge.textContent = contact.unread_count;
                    div.appendChild(badge);
                }

                div.onclick = () => openChatWith(contact.id, contact.username);
                contactItems.appendChild(div);
            });

            document.getElementById('contactList').classList.add('open');
            isContactListOpen = true;

            console.log('Demo contacts loaded successfully');
        }

        function openChatWith(contactId, contactName) {
            currentContactId = contactId;
            currentContactName = contactName;

            document.getElementById('chatTitle').textContent = `Chat with ${contactName}`;
            document.getElementById('chatInput').disabled = false;
            document.getElementById('contactList').classList.remove('open');
            isContactListOpen = false;

            // Load messages for this contact
            loadMessagesForContact(contactId);

            // Update contact selection
            document.querySelectorAll('.contact-item').forEach(item => {
                item.classList.remove('selected');
                if (item.dataset.contactId == contactId) {
                    item.classList.add('selected');
                }
            });
        }

        // FIXED LOAD MESSAGES WITH ERROR HANDLING
        async function loadMessagesForContact(contactId) {
            try {
                const response = await fetch(`/api/admin/messages/${contactId}`);
                if (!response.ok) throw new Error('Failed to load messages');

                const messages = await response.json();

                const messageArea = document.getElementById('messageArea');
                messageArea.innerHTML = '';

                if (messages.length === 0) {
                    messageArea.innerHTML = '<div class="chat-loading">No messages yet. Start the conversation!</div>';
                } else {
                    messages.forEach(msg => {
                        const div = document.createElement('div');
                        div.className = `chat-message ${msg.is_sent ? 'sent' : 'received'}`;
                        div.innerHTML = `
                            ${msg.content}
                            <br><small>${new Date(msg.timestamp).toLocaleTimeString()}</small>
                        `;
                        messageArea.appendChild(div);
                    });
                }

                messageArea.scrollTop = messageArea.scrollHeight;

            } catch (error) {
                console.error('Error loading messages:', error);

                // Show error and load demo messages
                const messageArea = document.getElementById('messageArea');
                messageArea.innerHTML = `
                    <div class="chat-error">
                        Failed to load messages. Showing demo conversation...
                    </div>
                `;

                // Load demo messages after a brief delay
                setTimeout(() => {
                    loadDemoMessages(contactId);
                }, 1500);
            }
        }

        // Load demo messages
        function loadDemoMessages(contactId) {
            const messageArea = document.getElementById('messageArea');

            const demoMessages = [
                {
                    id: 1,
                    is_sent: false,
                    content: "Hi! I have a question about the recent inspection report.",
                    timestamp: new Date(Date.now() - 3600000).toISOString()
                },
                {
                    id: 2,
                    is_sent: true,
                    content: "Sure! What would you like to know?",
                    timestamp: new Date(Date.now() - 3500000).toISOString()
                },
                {
                    id: 3,
                    is_sent: false,
                    content: "I need clarification on the hygiene score. Can we schedule a meeting?",
                    timestamp: new Date(Date.now() - 3400000).toISOString()
                }
            ];

            messageArea.innerHTML = '';

            demoMessages.forEach(msg => {
                const div = document.createElement('div');
                div.className = `chat-message ${msg.is_sent ? 'sent' : 'received'}`;
                div.innerHTML = `
                    ${msg.content}
                    <br><small>${new Date(msg.timestamp).toLocaleTimeString()}</small>
                `;
                messageArea.appendChild(div);
            });

            messageArea.scrollTop = messageArea.scrollHeight;
        }

        // FIXED SEND MESSAGE WITH ERROR HANDLING
        async function sendMessage() {
            if (!currentContactId) {
                showNotification('Please select a contact to send a message', 'warning');
                return;
            }

            const input = document.getElementById('chatInput');
            const content = input.value.trim();
            if (!content) return;

            console.log('Sending message:', content, 'to contact:', currentContactId);

            try {
                // Add message to UI immediately (optimistic update)
                const messageArea = document.getElementById('messageArea');
                const div = document.createElement('div');
                div.className = 'chat-message sent';
                div.innerHTML = `
                    ${content}
                    <br><small>${new Date().toLocaleTimeString()}</small>
                `;
                messageArea.appendChild(div);
                messageArea.scrollTop = messageArea.scrollHeight;

                input.value = '';

                // Send to server
                const response = await fetch('/api/admin/send_message', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        recipient_id: parseInt(currentContactId),
                        content: content
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to send message');
                }

                const result = await response.json();
                if (!result.success) {
                    throw new Error(result.error || 'Failed to send message');
                }

                console.log('Message sent successfully');

            } catch (error) {
                console.error('Error sending message:', error);
                showNotification('Message sent locally. Server sync may be delayed.', 'warning');
            }
        }

        function startPolling() {
            if (pollingInterval) return;
            pollingInterval = setInterval(() => {
                // Check for new messages and update notification badge
                updateChatNotificationBadge();
                updateMinimizedChatBadges();
            }, 5000); // Check every 5 seconds
        }

        function stopPolling() {
            if (pollingInterval) {
                clearInterval(pollingInterval);
                pollingInterval = null;
            }
        }

        function updateChatNotificationBadge() {
            // Simulate new messages for demo (in real app, this would fetch from server)
            const badge = document.getElementById('chatNotificationBadge');

            // Random chance of new messages
            if (Math.random() < 0.1) { // 10% chance every 5 seconds
                const currentCount = parseInt(badge.textContent) || 0;
                const newCount = currentCount + 1;

                badge.textContent = newCount;
                badge.classList.add('show');
            }
        }

        function updateMinimizedChatBadges() {
            // This would typically fetch new message counts from the server
            // For now, we'll simulate random updates
            minimizedChats.forEach((chatData, contactId) => {
                // Simulate random new messages (5% chance)
                if (Math.random() < 0.05) {
                    chatData.unreadCount += 1;
                    minimizedChats.set(contactId, chatData);

                    // Update the tab
                    const tab = document.querySelector(`[data-contact-id="${contactId}"]`);
                    if (tab) {
                        tab.classList.add('has-unread');
                        const unreadCountEl = tab.querySelector('.unread-count');
                        if (unreadCountEl) {
                            unreadCountEl.textContent = chatData.unreadCount;
                        } else {
                            const nameEl = tab.querySelector('.contact-name');
                            const newBadge = document.createElement('div');
                            newBadge.className = 'unread-count';
                            newBadge.textContent = chatData.unreadCount;
                            nameEl.after(newBadge);
                        }
                    }
                }
            });
        }

        // Chat input enter key handler
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('chatInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Click outside to close contact list
            document.addEventListener('click', (e) => {
                const contactList = document.getElementById('contactList');
                const chatContainer = document.querySelector('.chat-container');

                if (isContactListOpen && !chatContainer.contains(e.target)) {
                    contactList.classList.remove('open');
                    isContactListOpen = false;
                }
            });

            // Initialize search functionality and load data
            loadAllFormsData().then(() => {
                setupSearchListeners();
                console.log('Search system initialized with predictive capabilities');
            });
        });

        // Task-related functions
        function openTaskModal() {
            document.getElementById('taskModal').classList.add('open');
            loadTasks();
        }

        function closeTaskModal() {
            document.getElementById('taskModal').classList.remove('open');
        }

        async function loadTasks() {
            const tasksContainer = document.getElementById('tasks-container');
            const loadingDiv = document.getElementById('tasks-loading');

            loadingDiv.style.display = 'block';
            tasksContainer.innerHTML = '';

            try {
                const response = await fetch('/api/inspector/tasks');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const data = await response.json();
                loadingDiv.style.display = 'none';

                if (data.tasks && data.tasks.length > 0) {
                    data.tasks.forEach(task => {
                        const taskElement = createTaskElement(task);
                        tasksContainer.appendChild(taskElement);
                    });
                } else {
                    tasksContainer.innerHTML = `
                        <div class="empty-tasks">
                            <i>üìã</i>
                            <p>No tasks assigned yet.</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading tasks:', error);
                loadingDiv.style.display = 'none';
                tasksContainer.innerHTML = `
                    <div class="empty-tasks">
                        <i>‚ùå</i>
                        <p>Error loading tasks. Please try again.</p>
                    </div>
                `;
            }
        }

        function createTaskElement(task) {
            const taskDiv = document.createElement('div');
            const isOverdue = new Date(task.due_date) < new Date() && task.status === 'Pending';
            const taskClass = isOverdue ? 'overdue' : task.status.toLowerCase().replace(' ', '-');

            taskDiv.className = `task-item ${taskClass}`;
            taskDiv.innerHTML = `
                <div class="task-header">
                    <h3 class="task-title">${task.title}</h3>
                    <span class="task-status ${task.status.toLowerCase().replace(' ', '-')}">${task.status}</span>
                </div>
                <div class="task-details">${task.details || 'No details provided'}</div>
                <div class="task-meta">
                    <span>üìÖ Due: ${new Date(task.due_date).toLocaleDateString()}</span>
                    <span>üìù Assigned: ${new Date(task.created_at).toLocaleDateString()}</span>
                </div>
                <div class="task-actions">
                    ${task.status === 'Pending' ? `
                        <div class="task-response-buttons">
                            <button class="task-btn accept" onclick="respondToTask(${task.id}, 'accept')">
                                ‚úÖ Accept
                            </button>
                            <button class="task-btn decline" onclick="respondToTask(${task.id}, 'decline')">
                                ‚ùå Decline
                            </button>
                        </div>
                    ` : ''}
                    ${task.status === 'In Progress' ? `
                        <button class="task-btn complete" onclick="updateTaskStatus(${task.id}, 'Completed')">
                            ‚úÖ Mark Complete
                        </button>
                    ` : ''}
                    ${task.status === 'Completed' ? `
                        <span style="color: #28a745; font-weight: bold;">‚úÖ Task Completed</span>
                    ` : ''}
                    ${task.status === 'Declined' ? `
                        <span style="color: #dc3545; font-weight: bold;">‚ùå Task Declined</span>
                    ` : ''}
                </div>
            `;

            return taskDiv;
        }

        async function respondToTask(taskId, response) {
            try {
                const res = await fetch(`/api/inspector/tasks/${taskId}/respond`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        response: response
                    })
                });

                if (!res.ok) throw new Error(`HTTP ${res.status}`);

                const data = await res.json();
                if (data.success) {
                    loadTasks();
                    updateTaskNotificationBadge();

                    const message = response === 'accept' ? 'Task accepted! Status updated to In Progress.' : 'Task declined.';
                    showNotification(message, 'success');
                } else {
                    throw new Error(data.error || 'Failed to respond to task');
                }

            } catch (error) {
                console.error('Error responding to task:', error);
                showNotification('Failed to respond to task. Please try again.', 'error');
            }
        }

        async function updateTaskStatus(taskId, newStatus) {
            try {
                const response = await fetch(`/api/inspector/tasks/${taskId}/update`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: newStatus
                    })
                });

                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const data = await response.json();
                if (data.success) {
                    loadTasks();
                    updateTaskNotificationBadge();

                    showNotification(`Task status updated to: ${newStatus}`, 'success');
                } else {
                    throw new Error(data.error || 'Failed to update task status');
                }

            } catch (error) {
                console.error('Error updating task status:', error);
                showNotification('Failed to update task status. Please try again.', 'error');
            }
        }

        async function updateTaskNotificationBadge() {
            try {
                const response = await fetch('/api/inspector/tasks/unread_count');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const data = await response.json();
                const badge = document.getElementById('task-notification-badge');

                if (data.count > 0) {
                    badge.textContent = data.count;
                    badge.classList.add('show');
                } else {
                    badge.classList.remove('show');
                }
            } catch (error) {
                console.error('Error updating task notification badge:', error);
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                max-width: 300px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                background: ${type === 'success' ? 'linear-gradient(135deg, #28a745, #20c997)' :
                           type === 'error' ? 'linear-gradient(135deg, #dc3545, #e83e8c)' :
                           type === 'warning' ? 'linear-gradient(135deg, #ffc107, #fd7e14)' :
                           'linear-gradient(135deg, #007bff, #6610f2)'};
                animation: slideInNotification 0.3s ease-out;
            `;
            notification.textContent = message;

            // Add slide-in animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInNotification {
                    from {
                        opacity: 0;
                        transform: translateX(100%);
                    }
                    to {
                        opacity: 1;
                        transform: translateX(0);
                    }
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(notification);

            // Auto remove after 4 seconds
            setTimeout(() => {
                notification.style.animation = 'slideInNotification 0.3s ease-out reverse';
                setTimeout(() => {
                    notification.remove();
                    style.remove();
                }, 300);
            }, 4000);
        }

        // Polling for new tasks and notifications
        function startTaskPolling() {
            setInterval(() => {
                updateTaskNotificationBadge();
            }, 30000); // Check every 30 seconds
        }

        async function loadStats() {
            try {
                const response = await fetch('/stats');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();
                const totalCount = (data.food || 0) + (data.residential || 0) + (data.burial || 0) +
                                  (data.spirit_licence || 0) + (data.swimming_pool || 0) + (data.small_hotels || 0) +
                                  (data.barbershop || 0) + (data.institutional || 0) + (data.meat_processing || 0);
                document.querySelector('#total-inspections').textContent = totalCount || 0;
                document.querySelector('#food-inspections').textContent = data.food || 0;
                document.querySelector('#residential-inspections').textContent = data.residential || 0;
                document.querySelector('#burial-inspections').textContent = data.burial || 0;
                document.querySelector('#spirit-licence-inspections').textContent = data.spirit_licence || 0;
                document.querySelector('#swimming-pool-inspections').textContent = data.swimming_pool || 0;
                document.querySelector('#small-hotels-inspections').textContent = data.small_hotels || 0;
                document.querySelector('#barbershop-inspections').textContent = data.barbershop || 0;
                document.querySelector('#institutional-inspections').textContent = data.institutional || 0;
                document.querySelector('#meat-processing-inspections').textContent = data.meat_processing || 0;
            } catch (error) {
                console.error('Error loading stats:', error);
                document.querySelector('#total-inspections').textContent = '0';
                document.querySelector('#food-inspections').textContent = '0';
                document.querySelector('#residential-inspections').textContent = '0';
                document.querySelector('#burial-inspections').textContent = '0';
                document.querySelector('#spirit-licence-inspections').textContent = '0';
                document.querySelector('#swimming-pool-inspections').textContent = '0';
                document.querySelector('#small-hotels-inspections').textContent = '0';
                document.querySelector('#barbershop-inspections').textContent = '0';
                document.querySelector('#institutional-inspections').textContent = '0';
                document.querySelector('#meat-processing-inspections').textContent = '0';
            }
        }

        async function loadForms(tab) {
            if (tab === 'overview') {
                return; // No need to load forms for overview tab
            }

            // Use cached data if available, otherwise load from server
            if (allFormsData[tab] && allFormsData[tab].length > 0) {
                displaySearchResults(allFormsData[tab], tab);
            } else {
                // Fallback to server call if cache is empty
                let tbody;
                switch (tab) {
                    case 'food':
                        tbody = document.querySelector('#food-results-body');
                        break;
                    case 'residential':
                        tbody = document.querySelector('#residential-results-body');
                        break;
                    case 'burial':
                        tbody = document.querySelector('#burial-results-body');
                        break;
                    case 'spirit_licence':
                        tbody = document.querySelector('#spirit-licence-results-body');
                        break;
                    case 'swimming_pool':
                        tbody = document.querySelector('#swimming-pool-results-body');
                        break;
                    case 'small_hotels':
                        tbody = document.querySelector('#small-hotels-results-body');
                        break;
                    case 'barbershop':
                        tbody = document.querySelector('#barbershop-results-body');
                        break;
                    case 'institutional':
                        tbody = document.querySelector('#institutional-results-body');
                        break;
                    case 'meat_processing':
                        tbody = document.querySelector('#meat-processing-results-body');
                        break;
                    default:
                        return;
                }
                tbody.innerHTML = '<tr><td colspan="5">Loading...</td></tr>';
                try {
                    const response = await fetch(`/search_forms?query=&type=${tab}`);
                    const data = await response.json();
                    allFormsData[tab] = data.forms || [];
                    cachedFormsData[tab] = data.forms || []; // Also cache for global search
                    displaySearchResults(allFormsData[tab], tab);
                } catch (error) {
                    console.error(`Error loading ${tab} forms:`, error);
                    tbody.innerHTML = '<tr><td colspan="5">Error loading results</td></tr>';
                }
            }
        }

        // Update the existing window.onclick function
window.onclick = function(event) {
    const taskModal = document.getElementById('taskModal');
    const inspectionsModal = document.getElementById('myInspectionsModal');
    if (event.target === taskModal) {
        closeTaskModal();
    }
    if (event.target === inspectionsModal) {
        closeMyInspectionsModal();
    }
}

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeTaskModal();
                closeChat();
            }
        });

        // Global Search Functionality
        let globalSearchDebounceTimer;
        let cachedFormsData = {
            food: [],
            residential: [],
            burial: [],
            spirit_licence: [],
            swimming_pool: [],
            small_hotels: [],
            barbershop: [],
            institutional: [],
            meat_processing: []
        };

        function initializeGlobalSearch() {
            const searchInput = document.getElementById('globalSearchInput');
            const suggestions = document.getElementById('globalSearchSuggestions');

            if (!searchInput || !suggestions) return;

            searchInput.addEventListener('input', function(e) {
                clearTimeout(globalSearchDebounceTimer);
                const query = e.target.value.trim();

                if (query.length < 2) {
                    suggestions.classList.remove('active');
                    suggestions.innerHTML = '';
                    return;
                }

                globalSearchDebounceTimer = setTimeout(() => {
                    performGlobalSearch(query);
                }, 300);
            });

            searchInput.addEventListener('focus', function() {
                if (this.value.length >= 2) {
                    suggestions.classList.add('active');
                }
            });

            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !suggestions.contains(e.target)) {
                    suggestions.classList.remove('active');
                }
            });
        }

        async function performGlobalSearch(query) {
            try {
                // Search across all form types using the API
                const formTypes = ['food', 'residential', 'burial', 'spirit_licence', 'swimming_pool', 'small_hotels', 'barbershop', 'institutional', 'meat_processing'];
                const searchPromises = formTypes.map(type =>
                    fetch(`/search_forms?query=${encodeURIComponent(query)}&type=${type}`)
                        .then(res => res.json())
                        .then(data => ({
                            type: type,
                            forms: data.forms || []
                        }))
                        .catch(err => {
                            console.error(`Error searching ${type}:`, err);
                            return { type: type, forms: [] };
                        })
                );

                const allResults = await Promise.all(searchPromises);

                // Combine all results
                const combinedResults = [];
                allResults.forEach(({ type, forms }) => {
                    forms.forEach(form => {
                        combinedResults.push({
                            ...form,
                            formType: type
                        });
                    });
                });

                displayGlobalSearchResults(combinedResults.slice(0, 10));
            } catch (error) {
                console.error('Global search error:', error);
                const suggestions = document.getElementById('globalSearchSuggestions');
                suggestions.innerHTML = '<div class="global-suggestion-item">Search error occurred</div>';
                suggestions.classList.add('active');
            }
        }

        function getGlobalSearchableText(form, formType) {
            const fields = [];
            fields.push(form.establishment_name || form.premises_name || form.applicant_name || '');
            fields.push(form.owner || form.owner_operator || '');
            fields.push(form.address || '');
            fields.push(form.license_no || form.establishment_no || '');
            return fields.join(' ');
        }

        function calculateSearchScore(text, query) {
            const lowerText = text.toLowerCase();
            const lowerQuery = query.toLowerCase();
            let score = 0;

            if (lowerText.startsWith(lowerQuery)) score += 100;
            if (lowerText.includes(' ' + lowerQuery)) score += 50;
            score += (lowerText.match(new RegExp(lowerQuery, 'g')) || []).length * 10;

            return score;
        }

        function displayGlobalSearchResults(results) {
            const suggestions = document.getElementById('globalSearchSuggestions');

            if (results.length === 0) {
                suggestions.innerHTML = '<div class="global-suggestion-item">No results found</div>';
                suggestions.classList.add('active');
                return;
            }

            suggestions.innerHTML = results.map(result => {
                const name = result.establishment_name || result.premises_name || result.applicant_name || 'Unnamed';
                const owner = result.owner || result.owner_operator || '';
                const formTypeLabel = getFormTypeLabel(result.formType);
                const date = result.inspection_date || result.created_at || '';

                return `
                    <div class="global-suggestion-item" onclick="navigateToInspection(${result.id}, '${result.formType}')">
                        <div style="font-weight: 600; color: #111;">${name}</div>
                        <div style="font-size: 13px; color: #666; margin-top: 4px;">
                            ${owner ? `Owner: ${owner} ‚Ä¢ ` : ''}
                            ${formTypeLabel} ‚Ä¢ ${date}
                        </div>
                    </div>
                `;
            }).join('');

            suggestions.classList.add('active');
        }

        function getFormTypeLabel(formType) {
            const labels = {
                'food': 'Food Establishment',
                'residential': 'Residential',
                'burial': 'Burial Site',
                'spirit_licence': 'Spirit Licence',
                'swimming_pool': 'Swimming Pool',
                'small_hotels': 'Small Hotels',
                'barbershop': 'Barbershop',
                'institutional': 'Institutional Health',
                'meat_processing': 'Meat Processing'
            };
            return labels[formType] || formType;
        }

        function navigateToInspection(id, formType) {
            const urls = {
                'food': `/inspection/${id}`,
                'residential': `/residential/inspection/${id}`,
                'burial': `/burial/inspection/${id}`,
                'spirit_licence': `/spirit_licence/inspection/${id}`,
                'swimming_pool': `/swimming_pool/inspection/${id}`,
                'small_hotels': `/small_hotels/inspection/${id}`,
                'barbershop': `/barbershop/inspection/${id}`,
                'institutional': `/institutional/inspection/${id}`,
                'meat_processing': `/meat_processing/inspection/${id}`
            };
            window.location.href = urls[formType] || `/inspection/${id}`;
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadForms('overview');
            updateTaskNotificationBadge();
            startTaskPolling();
            initializeGlobalSearch();
            console.log('Inspector Dashboard initialized successfully!');
        });

        // Welcome message variations
const welcomeMessages = [
    "Welcome back",
    "Hey, welcome back Inspector",
    "Waa gwaan Inspector",
    "Good to see you back Inspector",
    "Welcome Inspector",
    "Hey there Inspector",
    "Nice to have you back Inspector",
    "Welcome back to work Inspector",
    "Ready for another day Inspector"
];

// Set personalized welcome message
function setWelcomeMessage() {
    const randomMessage = welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];
    // You'll need to pass the username from your backend - for now using placeholder
    const username = "{{ username }}"; // This should be replaced with actual template variable
    document.getElementById('welcomeTitle').textContent = `${randomMessage} ${username}!`;
}

// My Inspections functions
function openMyInspectionsModal() {
    document.getElementById('myInspectionsModal').classList.add('open');
    loadMyInspections('all');

    // Add event listeners for inspection tabs
    document.querySelectorAll('[data-inspection-tab]').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('[data-inspection-tab]').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            loadMyInspections(tab.dataset.inspectionTab);
        });
    });
}

function closeMyInspectionsModal() {
    document.getElementById('myInspectionsModal').classList.remove('open');
}

async function loadMyInspections(type = 'all') {
    const container = document.getElementById('my-inspections-container');
    const loadingDiv = document.getElementById('my-inspections-loading');

    loadingDiv.style.display = 'block';
    container.innerHTML = '';

    try {
        const response = await fetch(`/api/inspector/my_inspections?type=${type}`);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);

        const data = await response.json();
        loadingDiv.style.display = 'none';

        if (data.inspections && data.inspections.length > 0) {
            const table = document.createElement('table');
            table.className = 'my-inspections-table';
            table.innerHTML = `
                <thead>
                    <tr>
                        <th style="width: 60px;">ID</th>
                        <th style="width: 150px;">Type</th>
                        <th style="width: 250px;">Establishment/Premises</th>
                        <th style="width: 120px;">Date</th>
                        <th style="width: 120px;">Status</th>
                        <th style="width: 280px;">Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            `;

            const tbody = table.querySelector('tbody');

            data.inspections.forEach(inspection => {
                const row = document.createElement('tr');

                // Determine status class
                let statusClass = 'status-badge ';
                const result = inspection.result ? inspection.result.toLowerCase() : 'unknown';
                if (result === 'pass' || result === 'completed' || result === 'satisfactory') {
                    statusClass += 'status-pass';
                } else if (result === 'fail' || result === 'unsatisfactory') {
                    statusClass += 'status-fail';
                } else {
                    statusClass += 'status-unknown';
                }

                row.innerHTML = `
                    <td style="text-align: center; font-weight: bold;">${inspection.id}</td>
                    <td><strong>${inspection.type}</strong></td>
                    <td>${inspection.establishment_name || inspection.premises_name || 'N/A'}</td>
                    <td>${new Date(inspection.created_at).toLocaleDateString()}</td>
                    <td style="text-align: center;"><span class="${statusClass}">${inspection.result || 'N/A'}</span></td>
                    <td class="action-buttons">
                        <button onclick="viewInspection('${inspection.type}', ${inspection.id})" class="action-btn view-btn">View</button>
                        <button onclick="printInspection('${inspection.type}', ${inspection.id})" class="action-btn print-btn">Print</button>
                        <button onclick="downloadInspection('${inspection.type}', ${inspection.id})" class="action-btn download-btn">Download</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            container.appendChild(table);
        } else {
            container.innerHTML = `
                <div class="empty-tasks">
                    <i>üìã</i>
                    <p>No inspections found.</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('Error loading my inspections:', error);
        loadingDiv.style.display = 'none';
        container.innerHTML = `
            <div class="empty-tasks">
                <i>‚ùå</i>
                <p>Error loading inspections. Please try again.</p>
            </div>
        `;
    }
}

function viewInspection(type, id) {
    let url;
    switch(type.toLowerCase()) {
        case 'food':
        case 'food establishment':
            url = `/inspection/${id}`;
            break;
        case 'residential':
            url = `/residential/inspection/${id}`;
            break;
        case 'burial':
        case 'burial site':
            url = `/burial/inspection/${id}`;
            break;
        case 'spirit_licence':
        case 'spirit licence premises':
            url = `/spirit_licence/inspection/${id}`;
            break;
        case 'swimming_pool':
        case 'swimming pool':
            url = `/swimming_pool/inspection/${id}`;
            break;
        case 'small_hotels':
        case 'small hotel':
            url = `/small_hotels/inspection/${id}`;
            break;
        case 'barbershop':
            url = `/barbershop/inspection/${id}`;
            break;
        case 'institutional':
        case 'institutional health':
            url = `/institutional/inspection/${id}`;
            break;
        case 'meat_processing':
        case 'meat processing':
            url = `/meat_processing/inspection/${id}`;
            break;
        default:
            url = `/inspection/${id}`;
    }
    window.open(url, '_blank');
}

function printInspection(type, id) {
    // Open the inspection in a new window and trigger print dialog
    const viewUrl = getInspectionUrl(type, id);
    const printWindow = window.open(viewUrl, '_blank');
    if (printWindow) {
        printWindow.addEventListener('load', function() {
            printWindow.print();
        });
    }
}

function downloadInspection(type, id) {
    // Download PDF version (without photos)
    const downloadUrl = `/api/download_inspection/${type}/${id}`;
    window.location.href = downloadUrl;
}

function getInspectionUrl(type, id) {
    // Helper function to get inspection URL
    switch(type.toLowerCase()) {
        case 'food':
        case 'food establishment':
            return `/inspection/${id}`;
        case 'residential':
            return `/residential/inspection/${id}`;
        case 'burial':
        case 'burial site':
            return `/burial/inspection/${id}`;
        case 'spirit_licence':
        case 'spirit licence premises':
            return `/spirit_licence/inspection/${id}`;
        case 'swimming_pool':
        case 'swimming pool':
            return `/swimming_pool/inspection/${id}`;
        case 'small_hotels':
        case 'small hotel':
            return `/small_hotels/inspection/${id}`;
        case 'barbershop':
            return `/barbershop/inspection/${id}`;
        case 'institutional':
        case 'institutional health':
            return `/institutional/inspection/${id}`;
        case 'meat_processing':
        case 'meat processing':
            return `/meat_processing/inspection/${id}`;
        default:
            return `/inspection/${id}`;
    }
}

// Update the DOMContentLoaded event listener to include welcome message
document.addEventListener('DOMContentLoaded', () => {
    setWelcomeMessage(); // Add this line
    loadStats();
    loadForms('overview');
    updateTaskNotificationBadge();
    startTaskPolling();
    console.log('Inspector Dashboard initialized successfully!');
});

    </script>

    {% include 'zozi_badge.html' %}
</body>
</html>